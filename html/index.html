<!DOCTYPE html>
<html>
    <head>
        <!-- En-tÃªte de la page -->
        <meta charset="utf-8" />
        <link rel="stylesheet" href="index.css" />
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>

        <!-- Include jQuery -->

<!-- Include Simple Slider JavaScript and CSS -->
<script src="slider/js/simple-slider.js"></script>
<link href="slider/css/simple-slider.css" rel="stylesheet" type="text/css" />





        <title>WebSem 3000 : Le moteur de recherche des vrais bonhommes</title>

    </head>

    

    <body>
        <div id="divSlider"><input id="slider" type="text" data-slider-step="1" data-slider-range="0,100" data-slider="true" data-slider-highlight="true"/><label id="labelSlider">0,2</label></div>

        <div id="progressBar"><div id="img"></div></div>

        <div id="containerLogo">
    	<div id="logo">
    		<h1>WebSem 3000</h1>
    		<span id="moteur">Le moteur de recherche des vrais bonhommes<span><br>
            <div id="requette"><input id="req" type="text" placeholder="Ne tapez pas votre recherche ici..."/><input id="submit" type="button" value="Rechercher"/></div>
            <!-- Activate Simple Slider on your input -->
            

    	</div>
        </div>

        <div id="container">
        	<div id="listeResultat">
                <a href="http://sdlbsdflhsdblsd">http://www.le-lien.fdsqlibgsdly</a>

        	</div>
        </div>

    </body>

    <script type="text/javascript">

        //$("#slider").simpleSlider("setValue", 2);

        $("#slider").bind("slider:changed", function (event, data) {
          // The currently selected value of the slider
          //alert(data.value);
            $('#labelSlider').html(data.value);

            var val = data.value / 100;
            val = val.toFixed(2);

            console.log("New val :"+val);
            semanticRank(val);

          // The value as a ratio of the slider (between 0 and 1)
          //alert(data.ratio);
        });



        $('#submit').click(function(){
            progress();
            var req = $('#req').val();
            //semanticSearch(req);
            
            //semanticRank(0.02);
            //alert("testFIN");
            progressOff();
            layout();
        });


        function semanticSearch(search)
        {
            var request=new XMLHttpRequest();
            request.open("POST","http://localhost:4500/search",false);
            var txt = "\""+search+"\" 5 0.05";
            console.log("Request search sent");
            request.send(search); // bloquant
            traitement(request.responseText);
        }
        function semanticRank(search)
        {
            var request=new XMLHttpRequest();
            request.open("POST","http://localhost:4500/rank",false);
            console.log("Request rank sent");
            request.send(search); // bloquant
            traitement(request.responseText);
        }


        function traitement(text){
            var lines = text.split('\n');
            for(var i = 0;i < lines.length;i++){
                //code here using lines[i] which will give you each line
                var url = lines[i];
                $('#listeResultat').append('<div class="resultat"><a href="'+url+'" class="name">'+getNameURL(url)+'</a><br>');
                $('#listeResultat').append('<span class="url">'+url+'</span></div>');
            }

        }

        function getNameURL(url){
            url = url.trim();
            //console.log(url);
            //console.log("char : " + url.charAt(url.length-1));
            if( url.charAt(url.length-1) == '/'){
                url = url.substring(0,url.length-1);
            }
            /*
            var request=new XMLHttpRequest();
            console.log("url : "+url);
            request.open("GET",url,false);
            //request.setRequestHeader("Content-type","application/x-www-form-urlencoded");
            //request.setRequestHeader("Access-Control-Allow-Origin","*");
            request.send(null); // bloquant
            var parser = new DOMParser();
            var doc = parser.parseFromString(request.responseText,"text/xml");
            console.log(doc.getElementsByTagName("title")[0]);
            return ""+doc.getElementsByTagName("title")[0].innerHTML;
            */
            //console.log(xmlDoc.getElementByTagName("title"));
            var title = "";
            $.ajax({
                async: true,
                url: url,
                success: function(responseHtml) {
                    var newTitle = $(responseHtml).filter('title').text();
                    console.log(newTitle);
                },
                error: function(  jqXHR, textStatus, errorThrown ) {
                    console.log( jqXHR+', & '+textStatus+', & '+errorThrown );
                    title =  "Pas de titre";
                }
            });
            return "title";
        }

        function layout(){

            $('#container').animate({
                
                top:'75px'
            }, 1000);

            $('#containerLogo').animate({
                top:'-250px'
            });

            $('#logo').animate({
                width: '100%',
                padding: '35px -1px',
                border: 'none'
            });
        }

        function progress(){
            $('#progressBar').css({
                visibility:'visible'
            });

            $('#progressBar').animate({
                opacity:'100'
                /*top: '-2000px'*/
            },10000);

            $('#img').animate({
                opacity:'100'
            },20000);
        }

        function progressOff(){
            $('#img').animate({
                opacity:'0'
            },20000);

            $('#progressBar').animate({
                opacity:'0'
                /*top: '-2000px'*/
            },10000);

            $('#progressBar').css({
                visibility:'hidden'
            });
        }

            

    </script>

</html>